<div class="pl" style="display:none;"><div>
  <div class="img"><div><%= image_tag "" %></div></div>
  <div class="info">
    <div class="track"></div>
    <div class="artist"></div>
    <div class="album"></div>
  </div><div class="pbar">
    <audio id="player" controls="controls">      <source class="player-src" src="#" type="audio/mpeg"></source>
    </audio>
  </div>
</div></div>
<script>
$(document).ready(function() {
  $(".play-track").click(function() {
    $(".pl .img img").attr("src", $(this).attr("data-art"));
    $(".pl .info .track").text($(this).find("span.title").text());
    $(".pl .info .artist").text($(this).find("span.artist").text());
    $(".pl .info .album").text($(this).find("span.album").text());
    $(".curr-playing").removeClass("icon-vol-high");
    $(".curr-playing").addClass("icon-blank");
    $(this).find(".curr-playing").addClass("icon-vol-high");
    $(".player-src").remove();
    $("#player").append("<source class=\"player-src\" src=\"" + $(this).attr("data-url") + "\" type=\"audio/mpeg\"></source>")
    $("#player").attr("autoplay", "autoplay");
    $("#player").load();
    $(".pl").slideDown("fast");
    $(".pl").attr("data-track", $(this).attr("id"));
    window.location.replace("<%= request.url %>#" + $(this).attr("data-id"));
    return false;
  });
  $("#player").bind("ended", function() {
    $(".curr-playing").removeClass("icon-vol-high");
    $(".curr-playing").addClass("icon-blank");
    setTimeout(function(){ $("#" + $(".pl").attr("data-track")).parent().next().find(".play-track").click() }, 1000);
  });
  $("#player").bind("play", function() {
    $(".curr-playing").removeClass("icon-vol-high");
    $(".curr-playing").addClass("icon-blank");
    $("#" + $(".pl").attr("data-track")).find(".curr-playing").addClass("icon-vol-high");
  });
  if (window.location.hash != "") {
    var trackId = window.location.hash.substring(1);
    $("#track_" + trackId).click();
  }
});
</script>
